<ny19.xml>
  <quests>
    <NTQuest>
      <id>	ny19battle	</id>
      <enabled>	true	</enabled>
      <serverOnly>	true	</serverOnly>
      <conditions>
        <preBattle></preBattle>
        <postBattle></postBattle>
      </conditions>
      <scripts>	
QUEST_EVENT_TYPE = globals().get('QUEST_EVENT_TYPE')
def onInit(eventType, eventData, quest, processor):
    LOG('QUEST EVENT:onInit', eventType, quest.id)
    for event in events.iterkeys():
        processor.subscribe(event, quest)
    return True

def onFinishBattle(eventType, eventData, quest, processor):
    from soft_exception import SoftException
    from debug_utils import LOG_ERROR
    LOG('QUEST EVENT:onFinishBattle', eventType, quest.id)
    avatarResults = eventData['avatarResults']

    try:
        account = eventData.get('account')
        if account is None:
            return
        ny = account._newYear
        # credits          tmenXP               freeXP            xp
        ny19creditsFactor, ny19tankmenXPFactor, ny19freeXPFactor, ny19xpFactor = ny.getDynamicBonusFactorsForTag('ny19')

        eventData['results'][quest.id] = {
            'bonusCnt': 1,
            'progress': {'bonusCount': -1}
        }

        eventData['results'][quest.id].update({
            'bonus': {
                'vehicleXPFactor': ny19xpFactor,
                'creditsFactor': ny19creditsFactor,
                'freeXPFactor': ny19freeXPFactor,
                'tankmenXPFactor': ny19tankmenXPFactor,
            }
        })
        LOG('QUEST EVENT:onFinishBattle', ny19creditsFactor, ny19tankmenXPFactor, ny19xpFactor, ny19freeXPFactor)
    except SoftException as err:
        return
        
events = {
    QUEST_EVENT_TYPE.INIT: onInit,
    QUEST_EVENT_TYPE.FINISH_BATTLE: onFinishBattle,
}

def quest(eventType, eventData, quest, processor):
    LOG('QUEST EVENT:quest', eventType, quest.id)
    return events.get(eventType, lambda *args: False)(eventType, eventData, quest, processor)
         	</scripts>
      <bonus></bonus>
    </NTQuest>
  </quests>
</ny19.xml>
